{% extends "base.html" %}

{% block title %}{{ site_config.site_name if site_config else 'Welcome' }}{% endblock %}

{% block content %}
<section class="hero">
    <div class="container">
        <div class="hero-content">
            <h1>Welcome to {{ site_config.site_name if site_config else 'Our Learning Platform' }}</h1>
            <p class="hero-subtitle">{{ site_config.site_description if site_config else 'Start your learning journey today with our expert-led courses.' }}</p>
            <div class="hero-actions">
                <a href="/courses" class="btn btn-primary btn-lg">Browse Courses</a>
                {% if not current_user %}
                <a href="#contact" class="btn btn-outline btn-lg">Request Information</a>
                {% else %}
                <a href="/dashboard" class="btn btn-outline btn-lg">My Dashboard</a>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<section class="features">
    <div class="container">
        <h2 class="section-title">Why Choose Us</h2>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">??</div>
                <h3>Expert-Led Courses</h3>
                <p>Learn from industry professionals with real-world experience.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">??</div>
                <h3>Learn at Your Pace</h3>
                <p>Access courses anytime, anywhere, on any device.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">??</div>
                <h3>Get Certified</h3>
                <p>Earn certificates upon course completion.</p>
            </div>
        </div>
    </div>
</section>

<section class="courses-preview">
    <div class="container">
        <h2 class="section-title">Featured Courses</h2>
        <div class="courses-grid" id="featuredCourses">
            <p class="loading">Loading courses...</p>
        </div>
        <div class="text-center" style="margin-top: 2rem;">
            <a href="/courses" class="btn btn-outline">View All Courses</a>
        </div>
    </div>
</section>

{% if not current_user %}
<section class="contact-section" id="contact">
    <div class="container">
        <div class="contact-wrapper">
            <div class="contact-info">
                <h2>Get In Touch</h2>
                <p>Have questions about our courses? Want to learn more about what we offer? Fill out the form and we will get back to you shortly.</p>
                <div class="contact-details">
                    {% if site_config and site_config.contact_email %}
                    <div class="contact-item">
                        <span class="contact-icon">??</span>
                        <div>
                            <strong>Email Us</strong>
                            <a href="mailto:{{ site_config.contact_email }}">{{ site_config.contact_email }}</a>
                        </div>
                    </div>
                    {% endif %}
                    {% if site_config and site_config.contact_phone %}
                    <div class="contact-item">
                        <span class="contact-icon">??</span>
                        <div>
                            <strong>Call Us</strong>
                            <a href="tel:{{ site_config.contact_phone }}">{{ site_config.contact_phone }}</a>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="contact-form-wrapper">
                <form id="contactForm" class="contact-form">
                    <h3>Request Information</h3>
                    <div class="form-group">
                        <label for="contactName">Your Name *</label>
                        <input type="text" id="contactName" name="name" required placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="contactEmail">Email Address *</label>
                        <input type="email" id="contactEmail" name="email" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="contactPhone">Phone Number</label>
                        <input type="tel" id="contactPhone" name="phone" placeholder="Enter your phone (optional)">
                    </div>
                    <div class="form-group">
                        <label for="contactSubject">Subject *</label>
                        <select id="contactSubject" name="subject" required>
                            <option value="">Select a topic</option>
                            <option value="course-info">Course Information</option>
                            <option value="pricing">Pricing and Plans</option>
                            <option value="partnership">Partnership</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="contactMessage">Your Message *</label>
                        <textarea id="contactMessage" name="message" rows="4" required placeholder="Tell us what you would like to know..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Send Message</button>
                </form>
                <div id="contactSuccess" class="contact-success" style="display: none;">
                    <div class="success-icon">?</div>
                    <h3>Thank You!</h3>
                    <p>Your message has been sent. We will get back to you within 24 hours.</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<section class="cta">
    <div class="container">
        <div class="cta-content">
            <h2>Ready to Start Learning?</h2>
            <p>Join thousands of students already learning on our platform.</p>
            {% if current_user %}
            <a href="/courses" class="btn btn-primary btn-lg">Browse Courses</a>
            {% else %}
            <a href="/register" class="btn btn-primary btn-lg">Get Started Today</a>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}

{% block extra_styles %}
<style>
.contact-section { padding: 4rem 0; background: var(--gray-50); }
.contact-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; align-items: start; }
.contact-info h2 { font-size: 2rem; margin-bottom: 1rem; }
.contact-info > p { color: var(--gray-600); margin-bottom: 2rem; line-height: 1.6; }
.contact-details { display: flex; flex-direction: column; gap: 1.5rem; }
.contact-item { display: flex; align-items: flex-start; gap: 1rem; }
.contact-icon { font-size: 1.5rem; }
.contact-item strong { display: block; margin-bottom: 0.25rem; }
.contact-item a { color: var(--primary-color); text-decoration: none; }
.contact-form-wrapper { background: white; padding: 2rem; border-radius: 12px; box-shadow: var(--shadow); }
.contact-form h3 { margin-bottom: 1.5rem; font-size: 1.25rem; }
.contact-form .form-group { margin-bottom: 1.25rem; }
.contact-form label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
.contact-form input, .contact-form select, .contact-form textarea { width: 100%; padding: 0.75rem; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 1rem; }
.contact-form input:focus, .contact-form select:focus, .contact-form textarea:focus { outline: none; border-color: var(--primary-color); }
.contact-form textarea { resize: vertical; min-height: 100px; }
.btn-block { display: block; width: 100%; text-align: center; }
.contact-success { text-align: center; padding: 2rem; }
.success-icon { width: 60px; height: 60px; background: #d4edda; color: #28a745; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; margin: 0 auto 1rem; }
.contact-success h3 { color: #28a745; margin-bottom: 0.5rem; }
@media (max-width: 768px) { .contact-wrapper { grid-template-columns: 1fr; } }
</style>
{% endblock %}

{% block extra_scripts %}
<script>
async function loadFeaturedCourses() {
    try {
        const response = await fetch('/api/courses?limit=6');
        const courses = await response.json();
        const container = document.getElementById('featuredCourses');
        if (courses.length === 0) {
            container.innerHTML = '<p class="text-center text-muted">No courses available yet.</p>';
            return;
        }
        container.innerHTML = courses.map(course => `
            <div class="course-card">
                <div class="course-thumbnail">
                    ${course.thumbnail_url ? `<img src="${course.thumbnail_url}" alt="${course.title}">` : `<div class="course-placeholder">??</div>`}
                </div>
                <div class="course-content">
                    <span class="course-category">${course.category || 'General'}</span>
                    <h3 class="course-title">${course.title}</h3>
                    <p class="course-description">${course.short_description || ''}</p>
                    <div class="course-meta">
                        <span class="course-lessons">?? ${course.total_lessons} lessons</span>
                        <span class="course-level">${course.difficulty_level}</span>
                    </div>
                    <a href="/course/${course.id}" class="btn btn-primary btn-sm">View Course</a>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error:', error);
        document.getElementById('featuredCourses').innerHTML = '<p class="text-center text-muted">Unable to load courses.</p>';
    }
}
loadFeaturedCourses();

const contactForm = document.getElementById('contactForm');
if (contactForm) {
    contactForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = {
            name: document.getElementById('contactName').value,
            email: document.getElementById('contactEmail').value,
            phone: document.getElementById('contactPhone').value,
            subject: document.getElementById('contactSubject').value,
            message: document.getElementById('contactMessage').value
        };
        try {
            const response = await fetch('/api/contact', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });
            if (response.ok) {
                contactForm.style.display = 'none';
                document.getElementById('contactSuccess').style.display = 'block';
            } else {
                alert('Failed to send message. Please email us directly.');
            }
        } catch (error) {
            alert('Failed to send message. Please email us directly.');
        }
    });
}
</script>
{% endblock %}
