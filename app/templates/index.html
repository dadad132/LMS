{% extends "base.html" %}

{% block title %}{{ site_config.site_name if site_config else 'Welcome' }}{% endblock %}

{% block content %}
<!-- Hero Section - Fully Customizable -->
<section class="hero hero-{{ site_config.hero_style if site_config and site_config.hero_style else 'centered' }}" 
    style="{% if site_config and site_config.hero_background_image %}background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('{{ site_config.hero_background_image }}'); background-size: cover; background-position: center;{% elif site_config and site_config.hero_background_color %}background-color: {{ site_config.hero_background_color }};{% endif %}">
    <div class="container">
        <div class="hero-content">
            <h1>{{ site_config.hero_title if site_config and site_config.hero_title else 'Welcome to ' + (site_config.site_name if site_config else 'Our Learning Platform') }}</h1>
            <p class="hero-subtitle">{{ site_config.hero_subtitle if site_config and site_config.hero_subtitle else 'Start your learning journey today with our expert-led courses.' }}</p>
            <div class="hero-actions">
                {% if site_config and site_config.hero_button_text %}
                <a href="{{ site_config.hero_button_link or '/courses' }}" class="btn btn-primary btn-lg">{{ site_config.hero_button_text }}</a>
                {% else %}
                <a href="/courses" class="btn btn-primary btn-lg">Browse Courses</a>
                {% endif %}
                
                {% if not current_user %}
                    {% if site_config and site_config.hero_button2_text %}
                    <a href="{{ site_config.hero_button2_link or '/register' }}" class="btn btn-outline btn-lg">{{ site_config.hero_button2_text }}</a>
                    {% else %}
                    <a href="/register" class="btn btn-outline btn-lg">Get Started Free</a>
                    {% endif %}
                {% else %}
                <a href="/dashboard" class="btn btn-outline btn-lg">My Dashboard</a>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Statistics Section -->
{% if site_config and site_config.stats_enabled and site_config.stats_items %}
<section class="stats-section">
    <div class="container">
        <div class="stats-grid">
            {% for stat in site_config.stats_items %}
            <div class="stat-item">
                <span class="stat-number">{{ stat.number }}</span>
                <span class="stat-label">{{ stat.label }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Features Section - Fully Customizable -->
{% if site_config and site_config.features_enabled != false %}
<section class="features">
    <div class="container">
        <h2 class="section-title">{{ site_config.features_title if site_config and site_config.features_title else 'Why Choose Us' }}</h2>
        <div class="features-grid">
            {% if site_config and site_config.features_items and site_config.features_items|length > 0 %}
                {% for feature in site_config.features_items %}
                <div class="feature-card">
                    <div class="feature-icon">{{ feature.icon if feature.icon else '‚ú®' }}</div>
                    <h3>{{ feature.title }}</h3>
                    <p>{{ feature.description }}</p>
                </div>
                {% endfor %}
            {% else %}
            <div class="feature-card">
                <div class="feature-icon">üéì</div>
                <h3>Expert-Led Courses</h3>
                <p>Learn from industry professionals with real-world experience.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">‚è∞</div>
                <h3>Learn at Your Pace</h3>
                <p>Access courses anytime, anywhere, on any device.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üèÜ</div>
                <h3>Get Certified</h3>
                <p>Earn certificates upon course completion.</p>
            </div>
            {% endif %}
        </div>
    </div>
</section>
{% endif %}

<!-- Image Gallery Section -->
{% if site_config and site_config.gallery_enabled != false and site_config.gallery_images and site_config.gallery_images|length > 0 %}
<section class="gallery-section">
    <div class="container">
        <h2 class="section-title">{{ site_config.gallery_title or 'Gallery' }}</h2>
        <div class="gallery-grid">
            {% for img in site_config.gallery_images %}
            <div class="gallery-item">
                <img src="{{ img.url }}" alt="{{ img.title or 'Gallery image' }}" loading="lazy">
                {% if img.title or img.description %}
                <div class="gallery-overlay">
                    {% if img.title %}<div class="gallery-title">{{ img.title }}</div>{% endif %}
                    {% if img.description %}<div class="gallery-description">{{ img.description }}</div>{% endif %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Team Section -->
{% if site_config and site_config.team_enabled != false and site_config.team_members and site_config.team_members|length > 0 %}
<section class="team-section">
    <div class="container">
        <h2 class="section-title">{{ site_config.team_title or 'Meet Our Team' }}</h2>
        <div class="team-grid">
            {% for member in site_config.team_members %}
            <div class="team-card">
                <div class="team-avatar">
                    {% if member.image %}
                    <img src="{{ member.image }}" alt="{{ member.name }}">
                    {% else %}
                    <span class="team-avatar-placeholder">üë§</span>
                    {% endif %}
                </div>
                <div class="team-info">
                    <h3 class="team-name">{{ member.name }}</h3>
                    {% if member.role %}<p class="team-role">{{ member.role }}</p>{% endif %}
                    {% if member.bio %}<p class="team-bio">{{ member.bio }}</p>{% endif %}
                    <div class="team-links">
                        {% if member.email %}
                        <a href="mailto:{{ member.email }}" title="Email" class="team-link">üìß</a>
                        {% endif %}
                        {% if member.linkedin %}
                        <a href="{{ member.linkedin }}" target="_blank" rel="noopener" title="LinkedIn" class="team-link">üíº</a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Featured Courses Section -->
{% if site_config and site_config.courses_section_enabled != false %}
<section class="courses-preview">
    <div class="container">
        <h2 class="section-title">{{ site_config.courses_section_title if site_config and site_config.courses_section_title else 'Featured Courses' }}</h2>
        <div class="courses-grid" id="featuredCourses">
            <p class="loading">Loading courses...</p>
        </div>
        <div class="text-center" style="margin-top: 2rem;">
            <a href="/courses" class="btn btn-outline">View All Courses</a>
        </div>
    </div>
</section>
{% endif %}

<!-- Testimonials Section -->
{% if site_config and site_config.testimonials_enabled and site_config.testimonials_items %}
<section class="testimonials-section">
    <div class="container">
        <h2 class="section-title">{{ site_config.testimonials_title if site_config and site_config.testimonials_title else 'What Our Students Say' }}</h2>
        <div class="testimonials-grid">
            {% for testimonial in site_config.testimonials_items %}
            <div class="testimonial-card">
                {% if testimonial.image %}
                <img src="{{ testimonial.image }}" alt="{{ testimonial.name }}" class="testimonial-image">
                {% else %}
                <div class="testimonial-avatar">{{ testimonial.name[0] if testimonial.name else '?' }}</div>
                {% endif %}
                <p class="testimonial-text">"{{ testimonial.text }}"</p>
                <div class="testimonial-author">
                    <strong>{{ testimonial.name }}</strong>
                    {% if testimonial.role %}
                    <span>{{ testimonial.role }}</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Contact Section (for non-logged in users) -->
{% if not current_user %}
<section class="contact-section" id="contact">
    <div class="container">
        <div class="contact-wrapper">
            <div class="contact-info">
                <h2>Get In Touch</h2>
                <p>Have questions about our courses? Want to learn more about what we offer? Fill out the form and we will get back to you shortly.</p>
                <div class="contact-details">
                    {% if site_config and site_config.contact_email %}
                    <div class="contact-item">
                        <span class="contact-icon">üìß</span>
                        <div>
                            <strong>Email Us</strong>
                            <a href="mailto:{{ site_config.contact_email }}">{{ site_config.contact_email }}</a>
                        </div>
                    </div>
                    {% endif %}
                    {% if site_config and site_config.contact_phone %}
                    <div class="contact-item">
                        <span class="contact-icon">üìû</span>
                        <div>
                            <strong>Call Us</strong>
                            <a href="tel:{{ site_config.contact_phone }}">{{ site_config.contact_phone }}</a>
                        </div>
                    </div>
                    {% endif %}
                    {% if site_config and site_config.contact_address %}
                    <div class="contact-item">
                        <span class="contact-icon">üìç</span>
                        <div>
                            <strong>Visit Us</strong>
                            <span>{{ site_config.contact_address }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="contact-form-wrapper">
                <form id="contactForm" class="contact-form">
                    <h3>Request Information</h3>
                    <div class="form-group">
                        <label for="contactName">Your Name *</label>
                        <input type="text" id="contactName" name="name" required placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="contactEmail">Email Address *</label>
                        <input type="email" id="contactEmail" name="email" required placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="contactPhone">Phone Number</label>
                        <input type="tel" id="contactPhone" name="phone" placeholder="Enter your phone (optional)">
                    </div>
                    <div class="form-group">
                        <label for="contactSubject">Subject *</label>
                        <select id="contactSubject" name="subject" required>
                            <option value="">Select a topic</option>
                            <option value="course-info">Course Information</option>
                            <option value="pricing">Pricing and Plans</option>
                            <option value="partnership">Partnership</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="contactMessage">Your Message *</label>
                        <textarea id="contactMessage" name="message" rows="4" required placeholder="Tell us what you would like to know..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Send Message</button>
                </form>
                <div id="contactSuccess" class="contact-success" style="display: none;">
                    <div class="success-icon">‚úì</div>
                    <h3>Thank You!</h3>
                    <p>Your message has been sent. We will get back to you within 24 hours.</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- CTA Section - Fully Customizable -->
{% if site_config and site_config.cta_enabled != false %}
<section class="cta" style="{% if site_config and site_config.cta_background_image %}background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('{{ site_config.cta_background_image }}'); background-size: cover; background-position: center;{% elif site_config and site_config.cta_background_color %}background-color: {{ site_config.cta_background_color }};{% endif %}">
    <div class="container">
        <div class="cta-content">
            <h2>{{ site_config.cta_title if site_config and site_config.cta_title else 'Ready to Start Learning?' }}</h2>
            <p>{{ site_config.cta_subtitle if site_config and site_config.cta_subtitle else 'Join thousands of students already learning on our platform.' }}</p>
            {% if current_user %}
            <a href="/courses" class="btn btn-primary btn-lg">Browse Courses</a>
            {% else %}
            <a href="{{ site_config.cta_button_link if site_config and site_config.cta_button_link else '/register' }}" class="btn btn-primary btn-lg">{{ site_config.cta_button_text if site_config and site_config.cta_button_text else 'Get Started Today' }}</a>
            {% endif %}
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block extra_styles %}
<style>
/* Hero Styles */
.hero-left .hero-content { text-align: left; }
.hero-right .hero-content { text-align: right; }
.hero-split { display: flex; align-items: center; }

/* Stats Section */
.stats-section { padding: 3rem 0; background: var(--gray-100); }
.stats-grid { display: flex; justify-content: center; gap: 4rem; flex-wrap: wrap; }
.stat-item { text-align: center; }
.stat-number { display: block; font-size: 2.5rem; font-weight: 700; color: var(--primary-color); }
.stat-label { font-size: 1rem; color: var(--gray-600); }

/* Gallery Section - Auto-adjusts for any number of images */
.gallery-section { padding: 4rem 0; }
.gallery-grid { 
    display: flex; 
    flex-wrap: wrap; 
    justify-content: center; 
    gap: 1rem; 
}
.gallery-item { 
    position: relative; 
    border-radius: 10px; 
    overflow: hidden; 
    box-shadow: var(--shadow); 
    aspect-ratio: 4/3;
    flex: 0 1 calc(25% - 1rem); /* 4 items per row on desktop */
    min-width: 180px;
    max-width: 300px;
}
.gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
.gallery-item:hover img { transform: scale(1.08); }
.gallery-item:hover .gallery-overlay { opacity: 1; }
.gallery-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.85)); color: white; padding: 0.75rem; opacity: 0; transition: opacity 0.3s; }
.gallery-title { font-weight: 600; font-size: 0.9rem; margin-bottom: 0.25rem; }
.gallery-description { font-size: 0.8rem; opacity: 0.9; line-height: 1.3; }
@media (max-width: 1024px) { .gallery-item { flex: 0 1 calc(33.333% - 1rem); } }
@media (max-width: 768px) { .gallery-item { flex: 0 1 calc(50% - 0.5rem); min-width: 140px; } .gallery-grid { gap: 0.75rem; } }
@media (max-width: 480px) { .gallery-item { flex: 0 1 calc(50% - 0.5rem); min-width: 120px; max-width: none; } }

/* Team Section - Auto-adjusts for any number of members */
.team-section { padding: 4rem 0; background: var(--gray-50); }
.team-grid { 
    display: flex; 
    flex-wrap: wrap; 
    justify-content: center; 
    gap: 2rem; 
}
.team-card { 
    background: white; 
    border-radius: 12px; 
    box-shadow: var(--shadow); 
    overflow: hidden; 
    text-align: center; 
    transition: transform 0.2s, box-shadow 0.2s;
    flex: 0 1 280px;
    max-width: 320px;
}
.team-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }
.team-avatar { width: 120px; height: 120px; margin: 1.5rem auto 1rem; border-radius: 50%; overflow: hidden; background: var(--gray-200); display: flex; align-items: center; justify-content: center; }
.team-avatar img { width: 100%; height: 100%; object-fit: cover; }
.team-avatar-placeholder { font-size: 3rem; }
.team-info { padding: 0 1.5rem 1.5rem; }
.team-name { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.25rem; color: var(--gray-900); }
.team-role { font-size: 0.9rem; color: var(--primary-color); font-weight: 500; margin-bottom: 0.75rem; }
.team-bio { font-size: 0.9rem; color: var(--gray-600); line-height: 1.5; margin-bottom: 1rem; }
.team-links { display: flex; justify-content: center; gap: 0.75rem; }
.team-link { font-size: 1.25rem; text-decoration: none; transition: transform 0.2s; display: inline-block; }
.team-link:hover { transform: scale(1.2); }
@media (max-width: 768px) { .team-card { flex: 0 1 calc(50% - 1rem); min-width: 200px; } .team-grid { gap: 1.5rem; } }
@media (max-width: 480px) { .team-card { flex: 0 1 100%; max-width: 100%; } }

/* Testimonials Section - Auto-adjusts */
.testimonials-section { padding: 4rem 0; background: var(--gray-50); }
.testimonials-grid { 
    display: flex; 
    flex-wrap: wrap; 
    justify-content: center; 
    gap: 2rem; 
}
.testimonial-card { 
    background: white; 
    padding: 2rem; 
    border-radius: 12px; 
    box-shadow: var(--shadow); 
    text-align: center;
    flex: 0 1 340px;
    max-width: 400px;
}
.testimonial-image { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem; }
.testimonial-avatar { width: 80px; height: 80px; border-radius: 50%; background: var(--primary-color); color: white; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: bold; margin: 0 auto 1rem; }
.testimonial-text { font-style: italic; color: var(--gray-700); margin-bottom: 1rem; line-height: 1.6; }
.testimonial-author strong { display: block; color: var(--gray-900); }
.testimonial-author span { font-size: 0.9rem; color: var(--gray-500); }

/* Contact Section */
.contact-section { padding: 4rem 0; background: var(--gray-50); }
.contact-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; align-items: start; }
.contact-info h2 { font-size: 2rem; margin-bottom: 1rem; }
.contact-info > p { color: var(--gray-600); margin-bottom: 2rem; line-height: 1.6; }
.contact-details { display: flex; flex-direction: column; gap: 1.5rem; }
.contact-item { display: flex; align-items: flex-start; gap: 1rem; }
.contact-icon { font-size: 1.5rem; }
.contact-item strong { display: block; margin-bottom: 0.25rem; }
.contact-item a { color: var(--primary-color); text-decoration: none; }
.contact-form-wrapper { background: white; padding: 2rem; border-radius: 12px; box-shadow: var(--shadow); }
.contact-form h3 { margin-bottom: 1.5rem; font-size: 1.25rem; }
.contact-form .form-group { margin-bottom: 1.25rem; }
.contact-form label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
.contact-form input, .contact-form select, .contact-form textarea { width: 100%; padding: 0.75rem; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 1rem; }
.contact-form input:focus, .contact-form select:focus, .contact-form textarea:focus { outline: none; border-color: var(--primary-color); }
.contact-form textarea { resize: vertical; min-height: 100px; }
.btn-block { display: block; width: 100%; text-align: center; }
.contact-success { text-align: center; padding: 2rem; }
.success-icon { width: 60px; height: 60px; background: #d4edda; color: #28a745; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; margin: 0 auto 1rem; }
.contact-success h3 { color: #28a745; margin-bottom: 0.5rem; }

@media (max-width: 768px) { 
    .contact-wrapper { grid-template-columns: 1fr; }
    .stats-grid { gap: 2rem; }
}
</style>
{% endblock %}

{% block extra_scripts %}
<script>
async function loadFeaturedCourses() {
    try {
        const limit = {{ site_config.courses_max_display if site_config and site_config.courses_max_display else 6 }};
        const response = await fetch(`/api/courses?limit=${limit}`);
        const courses = await response.json();
        const container = document.getElementById('featuredCourses');
        if (!container) return;
        
        if (courses.length === 0) {
            container.innerHTML = '<p class="text-center text-muted">No courses available yet.</p>';
            return;
        }
        container.innerHTML = courses.map(course => `
            <div class="course-card">
                <div class="course-thumbnail">
                    ${course.thumbnail_url ? `<img src="${course.thumbnail_url}" alt="${course.title}">` : `<div class="course-placeholder">üìö</div>`}
                </div>
                <div class="course-content">
                    <span class="course-category">${course.category || 'General'}</span>
                    <h3 class="course-title">${course.title}</h3>
                    <p class="course-description">${course.short_description || ''}</p>
                    <div class="course-meta">
                        <span class="course-lessons">üìñ ${course.total_lessons} lessons</span>
                        <span class="course-level">${course.difficulty_level}</span>
                    </div>
                    <a href="/course/${course.id}" class="btn btn-primary btn-sm">View Course</a>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error('Error:', error);
        const container = document.getElementById('featuredCourses');
        if (container) {
            container.innerHTML = '<p class="text-center text-muted">Unable to load courses.</p>';
        }
    }
}
loadFeaturedCourses();

const contactForm = document.getElementById('contactForm');
if (contactForm) {
    contactForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const formData = {
            name: document.getElementById('contactName').value,
            email: document.getElementById('contactEmail').value,
            phone: document.getElementById('contactPhone').value,
            subject: document.getElementById('contactSubject').value,
            message: document.getElementById('contactMessage').value
        };
        try {
            const response = await fetch('/api/contact', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });
            if (response.ok) {
                contactForm.style.display = 'none';
                document.getElementById('contactSuccess').style.display = 'block';
            } else {
                alert('Failed to send message. Please email us directly.');
            }
        } catch (error) {
            alert('Failed to send message. Please email us directly.');
        }
    });
}
</script>
{% endblock %}
