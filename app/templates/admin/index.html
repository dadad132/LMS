<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - {{ site_config.site_name if site_config else 'LMS' }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <h2>üéì Admin Panel</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-item active" data-section="dashboard">
                    <span class="nav-icon">üìä</span> Dashboard
                </a>
                <a href="#homepage" class="nav-item" data-section="homepage">
                    <span class="nav-icon">üè†</span> Homepage Builder
                </a>
                <a href="#site-settings" class="nav-item" data-section="site-settings">
                    <span class="nav-icon">‚öôÔ∏è</span> Site Settings
                </a>
                <a href="#pages" class="nav-item" data-section="pages">
                    <span class="nav-icon">üìÑ</span> Pages
                </a>
                <a href="#courses" class="nav-item" data-section="courses">
                    <span class="nav-icon">üìö</span> Courses
                </a>
                <a href="#users" class="nav-item" data-section="users">
                    <span class="nav-icon">üë•</span> Users
                </a>
                <a href="#media" class="nav-item" data-section="media">
                    <span class="nav-icon">üñºÔ∏è</span> Media Library
                </a>
                {% if current_user.role.value == 'super_admin' %}
                <a href="#system" class="nav-item" data-section="system">
                    <span class="nav-icon">üîß</span> System Update
                </a>
                {% endif %}
                <hr>
                <a href="/" class="nav-item">
                    <span class="nav-icon">üåê</span> View Site
                </a>
                <a href="#" class="nav-item" onclick="logout()">
                    <span class="nav-icon">üö™</span> Logout
                </a>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="admin-main">
            <!-- Header -->
            <header class="admin-header">
                <h1 id="pageTitle">Dashboard</h1>
                <div class="header-actions">
                    <span class="user-info">
                        Welcome, <strong>{{ current_user.username }}</strong>
                        <span class="badge">{{ current_user.role.value }}</span>
                    </span>
                </div>
            </header>
            
            <!-- Content Sections -->
            <div class="admin-content">
                <!-- Dashboard Section -->
                <section id="dashboard" class="content-section active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-info">
                                <span class="stat-value" id="totalUsers">0</span>
                                <span class="stat-label">Total Users</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìö</div>
                            <div class="stat-info">
                                <span class="stat-value" id="totalCourses">0</span>
                                <span class="stat-label">Total Courses</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìù</div>
                            <div class="stat-info">
                                <span class="stat-value" id="totalEnrollments">0</span>
                                <span class="stat-label">Enrollments</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìÑ</div>
                            <div class="stat-info">
                                <span class="stat-value" id="totalPages">0</span>
                                <span class="stat-label">Pages</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="card">
                            <h3>Recent Users</h3>
                            <div id="recentUsers" class="list-container">Loading...</div>
                        </div>
                        <div class="card">
                            <h3>Quick Actions</h3>
                            <div class="quick-actions">
                                <button onclick="showSection('courses')" class="action-btn">‚ûï Add Course</button>
                                <button onclick="showSection('pages')" class="action-btn">üìÑ Create Page</button>
                                <button onclick="showSection('users')" class="action-btn">üë§ Add User</button>
                                <button onclick="showSection('homepage')" class="action-btn">üè† Edit Homepage</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Homepage Builder Section -->
                <section id="homepage" class="content-section">
                    <div class="section-header">
                        <h3>Homepage Builder</h3>
                        <button class="btn btn-primary" onclick="previewHomepage()">üëÅÔ∏è Preview</button>
                    </div>
                    
                    <!-- Hero Section Editor -->
                    <div class="card">
                        <h3>ü¶∏ Hero Section</h3>
                        <form id="heroForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="heroTitle">Hero Title</label>
                                    <input type="text" id="heroTitle" placeholder="Welcome to Our Platform">
                                </div>
                                <div class="form-group">
                                    <label for="heroStyle">Hero Style</label>
                                    <select id="heroStyle">
                                        <option value="centered">Centered</option>
                                        <option value="left">Left Aligned</option>
                                        <option value="right">Right Aligned</option>
                                        <option value="split">Split (Image + Text)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="heroSubtitle">Hero Subtitle</label>
                                <textarea id="heroSubtitle" rows="2" placeholder="Start your learning journey today"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="heroButton1Text">Primary Button Text</label>
                                    <input type="text" id="heroButton1Text" placeholder="Browse Courses">
                                </div>
                                <div class="form-group">
                                    <label for="heroButton1Link">Primary Button Link</label>
                                    <input type="text" id="heroButton1Link" placeholder="/courses">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="heroButton2Text">Secondary Button Text</label>
                                    <input type="text" id="heroButton2Text" placeholder="Get Started">
                                </div>
                                <div class="form-group">
                                    <label for="heroButton2Link">Secondary Button Link</label>
                                    <input type="text" id="heroButton2Link" placeholder="/register">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="heroBgColor">Background Color</label>
                                    <input type="color" id="heroBgColor" value="#1f2937">
                                </div>
                                <div class="form-group">
                                    <label>Background Image</label>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <input type="text" id="heroBgImage" placeholder="Select or upload an image" style="flex: 1;">
                                        <button type="button" class="btn btn-outline" onclick="showMediaPicker('heroBgImage')">üìÅ Browse</button>
                                        <button type="button" class="btn btn-outline" onclick="uploadHeroImage()">üì§ Upload</button>
                                    </div>
                                    <div id="heroBgPreview" style="margin-top: 10px;"></div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Hero Section</button>
                        </form>
                    </div>
                    
                    <!-- Features Section Editor -->
                    <div class="card">
                        <h3>‚ú® Features Section</h3>
                        <form id="featuresForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="featuresTitle">Section Title</label>
                                    <input type="text" id="featuresTitle" placeholder="Why Choose Us">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label" style="padding-top: 2rem;">
                                        <input type="checkbox" id="featuresEnabled" checked>
                                        Enable Features Section
                                    </label>
                                </div>
                            </div>
                            <div id="featuresContainer"></div>
                            <button type="button" class="btn btn-outline" onclick="addFeature()">‚ûï Add Feature</button>
                            <button type="submit" class="btn btn-primary" style="margin-left: 10px;">Save Features</button>
                        </form>
                    </div>
                    
                    <!-- Stats Section Editor -->
                    <div class="card">
                        <h3>üìä Statistics Section</h3>
                        <form id="statsForm">
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="statsEnabled">
                                    Enable Statistics Section
                                </label>
                            </div>
                            <div id="statsContainer"></div>
                            <button type="button" class="btn btn-outline" onclick="addStat()">‚ûï Add Statistic</button>
                            <button type="submit" class="btn btn-primary" style="margin-left: 10px;">Save Statistics</button>
                        </form>
                    </div>
                    
                    <!-- Testimonials Section Editor -->
                    <div class="card">
                        <h3>üí¨ Testimonials Section</h3>
                        <form id="testimonialsForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="testimonialsTitle">Section Title</label>
                                    <input type="text" id="testimonialsTitle" placeholder="What Our Students Say">
                                </div>
                                <div class="form-group">
                                    <label class="checkbox-label" style="padding-top: 2rem;">
                                        <input type="checkbox" id="testimonialsEnabled">
                                        Enable Testimonials Section
                                    </label>
                                </div>
                            </div>
                            <div id="testimonialsContainer"></div>
                            <button type="button" class="btn btn-outline" onclick="addTestimonial()">‚ûï Add Testimonial</button>
                            <button type="submit" class="btn btn-primary" style="margin-left: 10px;">Save Testimonials</button>
                        </form>
                    </div>
                    
                    <!-- CTA Section Editor -->
                    <div class="card">
                        <h3>üì¢ Call to Action Section</h3>
                        <form id="ctaForm">
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="ctaEnabled" checked>
                                    Enable CTA Section
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="ctaTitle">CTA Title</label>
                                <input type="text" id="ctaTitle" placeholder="Ready to Start Learning?">
                            </div>
                            <div class="form-group">
                                <label for="ctaSubtitle">CTA Subtitle</label>
                                <textarea id="ctaSubtitle" rows="2" placeholder="Join thousands of students today"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ctaButtonText">Button Text</label>
                                    <input type="text" id="ctaButtonText" placeholder="Get Started Today">
                                </div>
                                <div class="form-group">
                                    <label for="ctaButtonLink">Button Link</label>
                                    <input type="text" id="ctaButtonLink" placeholder="/register">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ctaBgColor">Background Color</label>
                                    <input type="color" id="ctaBgColor" value="#3b82f6">
                                </div>
                                <div class="form-group">
                                    <label>Background Image</label>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <input type="text" id="ctaBgImage" placeholder="Optional background image" style="flex: 1;">
                                        <button type="button" class="btn btn-outline" onclick="showMediaPicker('ctaBgImage')">üìÅ Browse</button>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Save CTA Section</button>
                        </form>
                    </div>
                    
                    <!-- Image Gallery Section -->
                    <div class="card">
                        <h3>üñºÔ∏è Image Gallery / Decorative Images</h3>
                        <p style="color: #666; margin-bottom: 1rem;">Add decorative images to your homepage. These will appear in a gallery section.</p>
                        <div id="galleryContainer" class="gallery-grid"></div>
                        <div style="margin-top: 1rem;">
                            <button type="button" class="btn btn-outline" onclick="showMediaPicker('addGalleryImage')">üìÅ Add from Media</button>
                            <button type="button" class="btn btn-primary" onclick="uploadGalleryImage()">üì§ Upload New Image</button>
                            <button type="button" class="btn btn-primary" onclick="saveGallery()" style="margin-left: 10px;">Save Gallery</button>
                        </div>
                        <input type="hidden" id="addGalleryImage" onchange="addGalleryImageFromPicker(this.value)">
                    </div>
                    
                    <!-- Courses Section Settings -->
                    <div class="card">
                        <h3>üìö Featured Courses Section</h3>
                        <form id="coursesSettingsForm">
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="coursesEnabled" checked>
                                    Show Featured Courses Section
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="coursesSectionTitle">Section Title</label>
                                    <input type="text" id="coursesSectionTitle" placeholder="Featured Courses">
                                </div>
                                <div class="form-group">
                                    <label for="coursesMaxDisplay">Max Courses to Show</label>
                                    <input type="number" id="coursesMaxDisplay" value="6" min="1" max="12">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Courses Settings</button>
                        </form>
                    </div>
                </section>

                <!-- Site Settings Section -->
                <section id="site-settings" class="content-section">
                    <div class="card">
                        <h3>Site Configuration</h3>
                        <form id="siteSettingsForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="siteName">Site Name</label>
                                    <input type="text" id="siteName" name="site_name">
                                </div>
                                <div class="form-group">
                                    <label for="siteDescription">Site Description</label>
                                    <textarea id="siteDescription" name="site_description" rows="2"></textarea>
                                </div>
                            </div>
                            
                            <h4>Color Scheme</h4>
                            <div class="color-grid">
                                <div class="form-group">
                                    <label>Primary Color</label>
                                    <input type="color" id="primaryColor" name="primary_color">
                                </div>
                                <div class="form-group">
                                    <label>Secondary Color</label>
                                    <input type="color" id="secondaryColor" name="secondary_color">
                                </div>
                                <div class="form-group">
                                    <label>Accent Color</label>
                                    <input type="color" id="accentColor" name="accent_color">
                                </div>
                                <div class="form-group">
                                    <label>Background Color</label>
                                    <input type="color" id="backgroundColor" name="background_color">
                                </div>
                                <div class="form-group">
                                    <label>Text Color</label>
                                    <input type="color" id="textColor" name="text_color">
                                </div>
                                <div class="form-group">
                                    <label>Header Background</label>
                                    <input type="color" id="headerBgColor" name="header_bg_color">
                                </div>
                            </div>
                            
                            <h4>Features</h4>
                            <div class="form-row">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="showLandingPage" name="show_landing_page">
                                    Show Landing Page
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="requireLogin" name="require_login">
                                    Require Login to View Courses
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="allowRegistration" name="allow_registration">
                                    Allow User Registration
                                </label>
                            </div>
                            
                            <h4>Contact Information</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="contactEmail">Contact Email</label>
                                    <input type="email" id="contactEmail" name="contact_email">
                                </div>
                                <div class="form-group">
                                    <label for="contactPhone">Contact Phone</label>
                                    <input type="text" id="contactPhone" name="contact_phone">
                                </div>
                            </div>
                            
                            <h4>Custom Code</h4>
                            <div class="form-group">
                                <label for="customCss">Custom CSS</label>
                                <textarea id="customCss" name="custom_css" rows="5" placeholder="/* Add your custom CSS here */"></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">Save Settings</button>
                        </form>
                    </div>
                    
                    <div class="card">
                        <h3>Site Logo</h3>
                        <form id="logoForm" enctype="multipart/form-data">
                            <div class="logo-preview" id="logoPreview">
                                <p>No logo uploaded</p>
                            </div>
                            <input type="file" id="logoFile" name="file" accept="image/*">
                            <button type="submit" class="btn btn-primary">Upload Logo</button>
                        </form>
                    </div>
                </section>
                
                <!-- Pages Section -->
                <section id="pages" class="content-section">
                    <div class="section-header">
                        <h3>Pages</h3>
                        <button class="btn btn-primary" onclick="showPageModal()">‚ûï Create Page</button>
                    </div>
                    <div class="card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Slug</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pagesTable">
                                <tr><td colspan="5">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Courses Section -->
                <section id="courses" class="content-section">
                    <div class="section-header">
                        <h3>Courses</h3>
                        <button class="btn btn-primary" onclick="showCourseModal()">‚ûï Create Course</button>
                    </div>
                    <div class="card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Lessons</th>
                                    <th>Enrolled</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="coursesTable">
                                <tr><td colspan="6">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Users Section -->
                <section id="users" class="content-section">
                    <div class="section-header">
                        <h3>Users</h3>
                        <button class="btn btn-primary" onclick="showUserModal()">‚ûï Add User</button>
                    </div>
                    <div class="card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Joined</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <tr><td colspan="6">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Media Section -->
                <section id="media" class="content-section">
                    <div class="section-header">
                        <h3>Media Library</h3>
                        <button class="btn btn-primary" onclick="showUploadModal()">üì§ Upload Files</button>
                    </div>
                    <div class="media-filters">
                        <select id="mediaTypeFilter">
                            <option value="">All Types</option>
                            <option value="image">Images</option>
                            <option value="video">Videos</option>
                            <option value="document">Documents</option>
                        </select>
                    </div>
                    <div class="media-grid" id="mediaGrid">
                        <p>Loading media...</p>
                    </div>
                </section>
                
                <!-- System Update Section (Super Admin Only) -->
                {% if current_user.role.value == 'super_admin' %}
                <section id="system" class="content-section">
                    <div class="section-header">
                        <h3>System Update</h3>
                    </div>
                    
                    <div class="card">
                        <h3>üîÑ Update from GitHub</h3>
                        <p>Pull the latest code from the GitHub repository to update your website.</p>
                        
                        <div id="versionInfo" style="margin: 1.5rem 0; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                            <p><strong>Current Version:</strong> <span id="currentCommit">Loading...</span></p>
                            <p><strong>Last Updated:</strong> <span id="commitDate">Loading...</span></p>
                            <p id="updateStatus" style="margin-top: 0.5rem;"></p>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn btn-outline" onclick="checkForUpdates()">üîç Check for Updates</button>
                            <button class="btn btn-primary" onclick="updateSystem()" id="updateBtn">‚¨áÔ∏è Pull Updates</button>
                        </div>
                        
                        <div id="updateOutput" style="margin-top: 1.5rem; display: none;">
                            <h4>Update Log:</h4>
                            <pre style="background: #1f2937; color: #10b981; padding: 1rem; border-radius: 8px; overflow-x: auto; white-space: pre-wrap;"></pre>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-top: 1.5rem;">
                        <h3>‚ö†Ô∏è Important Notes</h3>
                        <ul style="line-height: 1.8; color: #666;">
                            <li>Updates will pull the latest code from the main branch on GitHub.</li>
                            <li>After updating, you may need to restart the server for changes to take effect.</li>
                            <li>Make sure to backup your database before major updates.</li>
                            <li>Your uploaded files and database will NOT be affected by updates.</li>
                        </ul>
                    </div>
                </section>
                {% endif %}
            </div>
        </main>
    </div>
    
    <!-- Modals -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent">
            <!-- Dynamic content -->
        </div>
    </div>
    
    <script src="/static/js/admin.js"></script>
    <script src="/static/js/quiz.js"></script>
</body>
</html>

